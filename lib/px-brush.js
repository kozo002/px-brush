!function(t,a){"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof define&&define.amd?define(a):(t=t||self)["px-brush"]=a()}(this,function(){var t=/^#?[0-9A-Fa-f]{1,2}[0-9A-Fa-f]{1,2}[0-9A-Fa-f]{1,2}$/,a=/^rgb\((\s+)?[0-9]{1,3},(\s+)?[0-9]{1,3},(\s+)?[0-9]{1,3}(\s+)?\)$/,e=function(){function e(){this.canvases={}}var r=e.prototype;return r.parseColor=function(e){var r=t.test(e),n=a.test(e);if(!r&&!n)throw new Error("Color is not correct format. #123123 or rgb(123, 123, 123) format required.");if(r){var i="#"===e[0]?e.slice(1):e;return i=3===i.length?i.split("").reduce(function(t,a){return[].concat(t,[a,a])},[]).join(""):i,{r:parseInt(i.slice(0,2),16),g:parseInt(i.slice(2,4),16),b:parseInt(i.slice(4,6),16)}}if(n){var o=e.replace(/rgb|\s+|\(|\)/g,"").split(",").map(function(t){return parseInt(t)}),s=o[0],c=o[1],h=o[2];return{r:s=s>255?255:s,g:c=c>255?255:c,b:h=h>255?255:h}}},r.make=function(t){var a=t.size,e=t.color;try{a*=window.devicePixelRatio;var r=this.parseColor(e),n=JSON.stringify(r);if(this.canvases[n]=this.canvases[n]||{},null!=this.canvases[n][a])return this.canvases[n][a];var i=document.createElement("canvas");i.width=a+=a%2,i.height=a;for(var o=i.getContext("2d"),s=o.createImageData(a,a),c=0;c<s.data.length;c+=4)s.data[c]=255,s.data[c+1]=255,s.data[c+2]=255,s.data[c+3]=0;return this.plotCircle(2*a,4*a*(a/2),a/2,s,a,r),this.fillCircle(s,r),o.putImageData(s,0,0),this.canvases[n][a]=i,i}catch(t){console.error(t)}},r.plotCircle=function(t,a,e,r,n,i){var o=-e,s=0,c=2-2*e;do{var h=t-4*(o+1)+(a+4*n*(s-1));r.data[h+0]=i.r,r.data[h+1]=i.g,r.data[h+2]=i.b,r.data[h+3]=255;var d=t-s*(4*n)+(a-4*(o+1));r.data[d+0]=i.r,r.data[d+1]=i.g,r.data[d+2]=i.b,r.data[d+3]=255;var u=t+4*o+(a-s*(4*n));r.data[u+0]=i.r,r.data[u+1]=i.g,r.data[u+2]=i.b,r.data[u+3]=255;var f=t+4*n*(s-1)+(a+4*o);r.data[f+0]=i.r,r.data[f+1]=i.g,r.data[f+2]=i.b,r.data[f+3]=255,(e=c)<=s&&(c+=2*++s+1),(e>o||c>s)&&(c+=2*++o+1)}while(o<0)},r.fillCircle=function(t,a){for(var e=4*t.width,r=1;r<t.height-1;r+=1)for(var n=!1,i=!1,o=!1,s=0;s<e;s+=4){var c=e*r+s,h=t.data[c+3],d=255===h;d&&!n?n=!0:0===h&&n?i=!0:d&&n&&i&&(o=!0),n&&i&&!o&&(t.data[c]=a.r,t.data[c+1]=a.g,t.data[c+2]=a.b,t.data[c+3]=255)}},e}();return function(){function t(t){this.canvas=t,this.context=t.getContext("2d"),this.stampMaker=new e,this.configPixelRatio()}var a,r=t.prototype;return r.configPixelRatio=function(){var t=this.canvas,a=t.width,e=t.height;this.canvas.width=a*this.dpr,this.canvas.height=e*this.dpr,this.canvas.style.width=a+"px",this.canvas.style.height=e+"px",this.context.scale(this.dpr,this.dpr),this.context.imageSmoothingEnabled=!1},r.exportAsPNG=function(t){var a=this;return new Promise(function(e){var r=document.createElement("canvas"),n=r.getContext("2d"),i=a.canvas,o=i.width,s=i.height,c=o/a.dpr,h=s/a.dpr;r.width=c,r.height=h,n.imageSmoothingEnabled=!1,n.drawImage(a.canvas,0,0,o,s,0,0,c,h),r.toBlob(function(a){a.lastModifedDate=new Date,a.name=t,e(a)})})},r.distanceBetween=function(t,a){return Math.sqrt(Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2))},r.angleBetween=function(t,a){return Math.atan2(a.x-t.x,a.y-t.y)},r.draw=function(t){var a=t.from,e=t.to,r=t.size,n=t.color;this.context.globalCompositeOperation="source-over",this.brush({from:a,to:e,size:r,color:n})},r.erase=function(t){var a=t.from,e=t.to,r=t.size;this.context.globalCompositeOperation="destination-out",this.brush({from:a,to:e,size:r,color:"#000000"})},r.brush=function(t){var a=this,e=t.from,r=t.to,n=t.size,i=(n-n%2)/2,o=this.stampMaker.make({size:n,color:t.color});if(e.x!==r.x||e.y!==r.y)for(var s=this.distanceBetween(e,r),c=this.angleBetween(e,r),h=function(t){var r=e.x+Math.sin(c)*t-i,s=e.y+Math.cos(c)*t-i;window.requestAnimationFrame(function(){a.context.drawImage(o,Math.round(r),Math.round(s),n,n)})},d=0;d<s;d+=1)h(d);else{var u=e.y-i;this.context.drawImage(o,Math.round(e.x-i),Math.round(u),n,n)}},(a=[{key:"dpr",get:function(){return window.devicePixelRatio||1}}])&&function(t,a){for(var e=0;e<a.length;e++){var r=a[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,a),t}()});
//# sourceMappingURL=px-brush.min.js.map
